# Library management system

## Demo

View demo - [olexiy.pythonanywhere.com](http://olexiy.pythonanywhere.com)

## Overview

This project is for a small community library and has only two interfaces:
1. The first, not requiring any identifying information to be entered, should allow borrowers to search the catalogue to find out which books are available, if they are on loan or not (and if they are when they are due back)
2. The second interface is focused on library staff, allowing them to issue books to borrowers and return books that have been on loan.
The project was designed to be simple enough for any user to understand how it works without any training. Some functionality is repeated on different pages for a user convenience, for example the book can be return back to library from the **Borrower** as well as **Book** page; **Book** details page is accessible form multiple pages such as **Home/catalogue**, **Borrower**, **Overdue**


## Project structure
```
project
│   app.py
│   db.py
│   forms.py
│   requirements.txt 
|   README.md
│
└───static
│   │
│   └───css
│   │   │   bootstrap-icons.css
│   │   │   bootstrap.css
│   │
│   └───fonts
│   │   │   bootstrap-icons.woff
│   │   │   bootstrap.css
│   │
│   └───images
│   │   │   favicon.ico
│   │   │   logo.svg
│   │
│   └───js
│   │   │   bootstrap.min.js
│   │   │   jquery-3.3.1.slim.min.js
|   │   │   scroll-position.js
│   
└───templates
│   │
│   └───includes
│   │   │   admin_nav.html
|   |
|   │   404.html
|   │   book.html
|   │   borrower.html
|   │   borrowers.html
|   │   catalogue.html
|   │   layout.html
|   │   overdue.html
|   │   book.html
```

## Assumptions
It is assumed that:
* Non-admin users won’t be accessing “/admin” page and admin/staff know how to access this page
* Database is managed externally, hence there’s no functionality to add/modify books, borrowers, branches, etc.
* User can’t borrow the same book twice from any branch. 
app.py

## app.py

All routes are located in “app.py”
### 1. Catalogue/home page (for non-admin users)
``` 
@app.route("/")
def catalogue()...
```
This route generates a home page of the project for the user (borrower). It is the similar to the admin’s home page, but functionality is limited. Users can only search the available books by title and/or author and see the availability of a book at each branch. To make it easier for users to see what books are available at each branch the total number of copies and number of available copies are displayed next to the branch name. If there’s no copy of the book available then it show the nearest due date.

![catalogue book availability screenshot](https://user-images.githubusercontent.com/79574011/120907831-f31d5500-c6b8-11eb-854e-6692b8d5528a.png)

#### Variables & functions:
* ```form``` - holds the WTForm for books search
* ```is_post``` – is used to toggle “Show all books” link after user submits book search form.
![show all books link screenshot](https://user-images.githubusercontent.com/79574011/120907874-64f59e80-c6b9-11eb-8689-f11411b9f53d.png) 
* ```catalogue``` – list of either all books or books as per user search request
* ```admin_catalogue``` – is used to identify what page the user is on. If admin is on the admin home (book catalogue) page then “Show all books” has url pointing to “/admin”, and for users (non-admins) “Show all books” has url pointing to “/”
* ```is_not_admin_page``` – is used to hide admin’s navigation panel from the user

### 2. Catalogue/home page (for admin users)

```
@app.route("/admin")
def admin_catalogue()...
```
Generates a page that has the same functionality as users home page explained above but also admin’s home page includes some extra features:
* Book name has a link to a book page ![link to book page screenshot](https://user-images.githubusercontent.com/79574011/120907990-6a071d80-c6ba-11eb-972d-d719de4552f7.png)
* Navigation panel ![navigation panel screenshot](https://user-images.githubusercontent.com/79574011/120907997-77bca300-c6ba-11eb-99bc-430333d040df.png)


### 3. Book page

``` 
@app.route("/admin/book/<int:book_id>")
def admin_book(book_id=None)...
```
This route generates a particular book page by book id. 
#### Variables & functions:

* ```branch_forms``` - holds a list of forms where admin can find a borrower by name or card number and lend the book from a particular branch. The list is generated by looping through every branch that has a copy of the book.
![search borrower screenshot](https://user-images.githubusercontent.com/79574011/120908116-514b3780-c6bb-11eb-9e6b-90401b43cbb7.png)

* ```return_book_forms``` – holds a list of “return book” forms (button and hidden fields)
* ```book``` – holds data for a particular book
* ```borrowers``` – holds a list of all borrowers available in a database. Used to populate the datalist for the “Lend book” field
![list of all borrowers screenshot](https://user-images.githubusercontent.com/79574011/120908141-822b6c80-c6bb-11eb-94fa-37b3dfa57e94.png)
* ```branches``` – holds list of branches that have a copy of this book
![list of branches screenshot](https://user-images.githubusercontent.com/79574011/120908157-aab36680-c6bb-11eb-91a3-6b95cc3ad8e9.png)
* ```current_borrowers``` - list of users who lent this book

### 4. Borrower page
```
@app.route("/admin/borrower/<int:card_no>")
def admin_borrower(card_no = None)...
```
Generates borrower page, that shows the borrower details as well a history of loans. Admin can “return” a book that has been on loan.

![book status screenshot](https://user-images.githubusercontent.com/79574011/120908204-0ed62a80-c6bc-11eb-9fe8-29eea7e443ef.png)

#### Variables & functions:

* ```borrower_loans``` - list of all books including already returned as well as currently on loan

### 5. Borrowers page
```
@app.route("/admin/borrowers")
def admin_borrowers()...
```
Generates a page that shows a list of all borrowers and how many books they have on loan at the moment. Admin can find borrowers by card number of name.

![borrowers page screenshot](https://user-images.githubusercontent.com/79574011/120908267-72f8ee80-c6bc-11eb-9912-92e2289a57ec.png)

#### Variables & functions:
* ```is_post``` – used to toggle "Show all books" link after search form was submitted
* ```query``` – holds a value that admin enters in the “search borrower” form
* ```borrowers``` – list of all borrowers or according to the query 

### 6. Overdue page
```
@app.route("/admin/overdue")
def admin_overdue()...
```
Generates a page that shows a list of all overdue books & their borrowers.

### 7. 404 page
```
@app.errorhandler(404)
def page_not_found(e)...
```
Generates 404 page

### Helper functions
This file also contains some “helper” functions for those functions that are used within more than one route function to avoid code duplication:

* ```helper_search_books ```  – returns a dictionary of all books and branches. This function is used to search books on the borrower page as well as admin book catalogue. Also, this function returns books according to the user search query.
* ```helper_return_book ``` – this function executes a query that returns books that has been on loan. Function is used on in the “books” and “borrower” pages.
* ```helper_generate_return_book_forms ``` – this form returns a list of forms (“Return book” button with hidden fields) for a list of books. Function is used on in the “books” and “borrower” pages.

## db.py
Contains functions with SQL queries. All queries have self-explanatory names.
* ```get_borrower``` – returns borrower data
*  ```get_borrower_loans``` – returns all loans
* ```get_borrowers``` – returns a list of borrowers
* ```return_book``` – executes UPDATE query when borrower returns a book
* ```lend_book``` – executes INSERT query when a book is lent
* ```get_all_branches``` – returns a list of branches. If book ID is supplied then returns branches that have a copy of the book, otherwise returns a list of all branches.
* ```get_books``` – returns a list of books. If not params supplied then returns all books, if only book ID is supplied than shows only one book data and also used to search books by author and/or book name
* ```get_overdue``` – returns a list of overdue books
* ```get_book_current_borrowers``` – returns a list of borrowers that currently have book on loan

## connect.py
This file contains credentials for the database connection. For security reason this file is only created on the server and not available in this repository.